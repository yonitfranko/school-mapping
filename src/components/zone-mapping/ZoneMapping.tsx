"use client"

import React, { useState, useEffect, useCallback } from 'react';
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";

interface ZoneItem {
  id: number;
  title: string;
  description: string;
}

interface Zone {
  id: string;
  title: string;
  items: ZoneItem[];
}
const zones: Zone[] = [
  {
    id: 'leadership',
    title: 'מנהיגות ותרבות בית ספרית',
    items: [
      { 
        id: 1, 
        title: 'חזון בהיר וממוקד', 
        description: 'בבית הספר קיים חזון ברור ומוסכם המבטא את זהותו הייחודית'
      },
      { 
        id: 2, 
        title: 'חזון בהיר וממוקד', 
        description: 'התפיסה החינוכית של בית הספר באה לידי ביטוי בתוכנית העבודה הבית ספרית'
      },
      { 
        id: 3, 
        title: 'חזון בהיר וממוקד', 
        description: 'בית הספר מקדם פעילויות ומקצה משאבים להטמעת התפיסה החינוכית שלו'
      },
      { 
        id: 4, 
        title: 'תוכנית עבודה', 
        description: 'תוכנית העבודה נבנית על בסיס מיפוי צרכים ואיסוף נתונים'
      },
      { 
        id: 5, 
        title: 'תוכנית עבודה', 
        description: 'תוכנית העבודה כוללת יעדים, מדדים ומשאבים'
      },
      { 
        id: 6, 
        title: 'תוכנית עבודה', 
        description: 'מתקיים מעקב אחר יישום תוכנית העבודה ואחר ניצול המשאבים'
      },
      { 
        id: 7, 
        title: 'פיתוח צוות הנהלה', 
        description: 'עבודת ההנהלה ובעלי התפקידים מתנהלת על בסיס תוכנית עבודה סדורה הכוללת מטרות ויעדים'
      },
      { 
        id: 8, 
        title: 'פיתוח צוות הנהלה', 
        description: 'קיימת הגדרת תפקידים ברורה וחלוקה מאוזנת של תחומי אחריות בין בעלי התפקידים בבית הספר'
      },
      { 
        id: 9, 
        title: 'פיתוח צוות הנהלה', 
        description: 'בבית הספר קיימת מנהיגות ביניים השותפה בהובלת בית הספר ונוטלת אחריות שווה בניהולו'
      },
      { 
        id: 10, 
        title: 'פיתוח צוות הנהלה', 
        description: 'בעלי התפקידים מקבלים ליווי מקצועי וכלים לניהול ולהובלה של צוות'
      },
      { 
        id: 11, 
        title: 'שגרות ארגוניות', 
        description: 'מערכת השעות נבנית על בסיס מיפוי צרכים ומבטאת את יעדי בית הספר ואת זהותו הייחודית'
      },
      { 
        id: 12, 
        title: 'שגרות ארגוניות', 
        description: 'ישיבות ההנהלה והצוות מעוגנות במערכת השעות, מתרחשות בקביעות ומתועדות'
      },
      { 
        id: 13, 
        title: 'שגרות ארגוניות', 
        description: 'ההחלטות המתקבלות הן מבוססות למידה ונתונים, מיושמות בשטח ונתונות לתהליך בקרה והערכה'
      },
      { 
        id: 14, 
        title: 'ניהול משאבים', 
        description: 'הקצאת המשאבים נעשית על בסיס מיפוי צורכי התלמידים ויעדי בית הספר'
      },
      { 
        id: 15, 
        title: 'ניהול משאבים', 
        description: 'מתקיים מעקב שיטתי, הכולל איסוף נתונים על אופן ניצול המשאבים'
      },
      { 
        id: 16, 
        title: 'ניהול משאבים', 
        description: 'נעשה תהליך של בקרה והערכה בנוגע לאפקטיביות של השימוש בשעות התקן ובשעות הפרטניות'
      }
    ]
  },
  {
    id: 'staff',
    title: 'צוות חינוכי',
    items: [
      { 
        id: 1, 
        title: 'מחויבות לתלמידים ולבית הספר', 
        description: 'הצוות החינוכי מחויב לקידום בית הספר'
      },
      { 
        id: 2, 
        title: 'מחויבות לתלמידים ולבית הספר', 
        description: 'לצוות החינוכי תחושת מסוגלות והוא מאמין ביכולתו לתת מענה לצורכי התלמידים'
      },
      { 
        id: 3, 
        title: 'מחויבות לתלמידים ולבית הספר', 
        description: 'הצוות החינוכי מציב רף ציפיות גבוה תוך מחויבות למגוון התלמידים'
      },
      { 
        id: 4, 
        title: 'למידה והתמקצעות של הצוות', 
        description: 'מתקיים תהליך פיתוח מקצועי רלוונטי המתבסס על צורכי הלמידה של המורים'
      },
      { 
        id: 5, 
        title: 'למידה והתמקצעות של הצוות', 
        description: 'המורים מיישמים בכיתות את הנלמד בפיתוח המקצועי'
      },
      { 
        id: 6, 
        title: 'למידה והתמקצעות של הצוות', 
        description: 'מורי בית הספר מקבלים הדרכה סדורה בתחומי הדעת בהלימה לצרכים'
      },
      { 
        id: 7, 
        title: 'למידה והתמקצעות של הצוות', 
        description: 'מתקיימת למידת עמיתים משותפת של המורים לשם שיפור איכות ההוראה'
      },
      { 
        id: 8, 
        title: 'רווחת המורה', 
        description: 'בית הספר מעניק למורים ליווי וחניכה אישית לחיזוק עבודתם הפדגוגית'
      },
      { 
        id: 9, 
        title: 'רווחת המורה', 
        description: 'תהליכי הקליטה והליווי של המורים החדשים מותאמים לצרכים שלהם'
      },
      { 
        id: 10, 
        title: 'רווחת המורה', 
        description: 'קיימים מענים של ייעוץ, ליווי ותמיכה במורים, ברווחתם ובחוסנם הרגשי'
      },
      { 
        id: 11, 
        title: 'רווחת המורה', 
        description: 'מתקיימים מפגשי גיבוש ופעילויות לחיזוק לכידות הצוות'
      }
    ]
  },
  {
    id: 'climate',
    title: 'למידה רגשית-חברתית ואקלים',
    items: [
      { 
        id: 1, 
        title: 'מיפוי אקלים בית ספרי', 
        description: 'צוות בית הספר מנתח את נתוני מיפוי האקלים הבית ספרי ומקצה מענים רגשיים-חברתיים בהתאם לתוצאות'
      },
      { 
        id: 2, 
        title: 'מיפוי אקלים בית ספרי', 
        description: 'קיימות שגרות למעקב אחר אפקטיביות המענים הרגשיים-חברתיים'
      },
      { 
        id: 3, 
        title: 'מיפוי אקלים בית ספרי', 
        description: 'בית הספר מפעיל מנגנונים ומסגרות לאיתור תלמידים בסיכון ולטיפול בהם'
      },
      { 
        id: 4, 
        title: 'קידום תחושת מוגנות, שייכות, מעורבות, אוטונומיה ומסוגלות', 
        description: 'התקנון הבית ספרי כולל נהלים, כללים וגבולות, והוא נאכף באופן קבוע'
      },
      { 
        id: 5, 
        title: 'קידום תחושת מוגנות, שייכות, מעורבות, אוטונומיה ומסוגלות', 
        description: 'פועלות תוכניות ויוזמות לחיזוק תחושת המוגנות של התלמידים ושל הצוות'
      },
      { 
        id: 6, 
        title: 'קידום תחושת מוגנות, שייכות, מעורבות, אוטונומיה ומסוגלות', 
        description: 'מתקיימות פעילויות חברתיות לחיזוק תחושת השייכות וגאוות היחידה של התלמידים והצוות'
      },
      { 
        id: 7, 
        title: 'טיפוח יחסי קרבה ואכפתיות בין מורים לתלמידים', 
        description: 'המורים מקיימים מפגשי שיח אישי רגשי-חברתי עם התלמידים באופן סדור ושיטתי'
      },
      { 
        id: 8, 
        title: 'טיפוח יחסי קרבה ואכפתיות בין מורים לתלמידים', 
        description: 'המורים יוצרים היכרות עם עולמם של התלמידים ומטפחים את הקשר עימם'
      },
      { 
        id: 9, 
        title: 'טיפוח יחסי קרבה ואכפתיות בין מורים לתלמידים', 
        description: 'המורים מקבלים ליווי והדרכה מקצועיים לקיום שיח אישי, מתן תמיכה רגשית ומענה אישי לתלמידים'
      },
      { 
        id: 10, 
        title: 'טיפוח יחסי קרבה ואכפתיות בין מורים לתלמידים', 
        description: 'המורים מטפחים את האווירה החברתית בכיתה ויוצרים קהילת לומדים סובלנית ומכבדת'
      },
      { 
        id: 11, 
        title: 'פיתוח מיומנויות רגשיות-חברתיות', 
        description: 'מתקיימים שיעורי חינוך וכישורי חיים לפיתוח מיומנויות רגשיות וחברתיות בהתאמה לגיל'
      },
      { 
        id: 12, 
        title: 'פיתוח מיומנויות רגשיות-חברתיות', 
        description: 'ההורים מעודכנים באופן שוטף אודות ההתפתחות הרגשית-חברתית של ילדיהם ושותפים לקידומם בתחום'
      },
      { 
        id: 13, 
        title: 'פיתוח מיומנויות רגשיות-חברתיות', 
        description: 'קיים מגוון רחב של מענים לטיפול בקשיים רגשיים והתנהגותיים: שעות יעוץ, פסיכולוג, מטפלים רגשיים ועוד'
      }
    ]
  },
  {
    id: 'teaching',
    title: 'תהליכי הוראה-למידה',
    items: [
      { 
        id: 1, 
        title: 'תכנון ההוראה', 
        description: 'הצוות החינוכי מקיים תהליכי מיפוי של ידע ומיומנויות במספר צמתים'
      },
      { 
        id: 2, 
        title: 'תכנון ההוראה', 
        description: 'בעקבות המיפוי מאותרים צורכי התלמידים, נקבעים יעדים מדידים וניתנים מענים לימודיים'
      },
      { 
        id: 3, 
        title: 'תכנון ההוראה', 
        description: 'בית הספר בוחן את האפקטיביות של המענים הניתנים על בסיס נתונים ומסיק מסקנות'
      },
      { 
        id: 4, 
        title: 'תכנון ההוראה', 
        description: 'בית הספר מקדם פיתוח של אוריינות שפתית ומתמטית ופועל לצמצום פערי למידה בתחומים אלה'
      },
      { 
        id: 5, 
        title: 'תכנון ההוראה', 
        description: 'הצוות החינוכי יוזם ומוביל תהליכי יזמות וחדשנות פדגוגית'
      },
      { 
        id: 6, 
        title: 'יישום פרקטיקות הוראה', 
        description: 'המורים עושים שימוש בפרקטיקות הוראה מגוונות'
      },
      { 
        id: 7, 
        title: 'יישום פרקטיקות הוראה', 
        description: 'המורים משלבים בשיעורים דרכי למידה מגוונות: מליאה, קבוצות, למידה פרטנית'
      },
      { 
        id: 8, 
        title: 'יישום פרקטיקות הוראה', 
        description: 'המורים משלבים בהוראה כלים דיגיטליים ושיטות למידה היברידיות'
      },
      { 
        id: 9, 
        title: 'יישום פרקטיקות הוראה', 
        description: 'מתקיימים תהליכי הוראה דיפרנציאליים כדי לתמוך בהיבטים לימודיים, רגשיים וחברתיים'
      },
      { 
        id: 10, 
        title: 'יישום פרקטיקות הוראה', 
        description: 'המורים מחזקים בקרב התלמידים מיומנויות חשיבה מסדר גבוה'
      },
      { 
        id: 11, 
        title: 'יישום פרקטיקות הוראה', 
        description: 'המורים מסייעים לתלמידים בפיתוח התפקודים הניהוליים'
      },
      { 
        id: 12, 
        title: 'משוב והערכה', 
        description: 'בית הספר מקיים תהליכי הערכה בצמתים מרכזיים'
      },
      { 
        id: 13, 
        title: 'משוב והערכה', 
        description: 'למורים יש ידע ומיומנויות להובלת תהליכי הערכה פנימית בבית הספר'
      },
      { 
        id: 14, 
        title: 'משוב והערכה', 
        description: 'המורים משלבים בתהליכי ההוראה-למידה תהליכי משוב, רפלקציה והערכה עצמית'
      },
      { 
        id: 15, 
        title: 'משוב והערכה', 
        description: 'קיימים קריטריונים ברורים ואחידים להערכת תלמידים'
      },
      { 
        id: 16, 
        title: 'גמישות פדגוגית ניהולית', 
        description: 'למורים ניתנת גמישות בארגון הלמידה באשכולות'
      },
      { 
        id: 17, 
        title: 'גמישות פדגוגית ניהולית', 
        description: 'נעשה מיקוד של תוכנית הלימודים ושל התכנים הנלמדים'
      },
      { 
        id: 18, 
        title: 'גמישות פדגוגית ניהולית', 
        description: 'למורים יש הידע והמיומנויות הנדרשים להובלת למידה בין-תחומית'
      }
    ]
  },
  {
    id: 'community',
    title: 'חינוך חברתי קהילתי',
    items: [
      { 
        id: 1, 
        title: 'מענים לרצף היום והשנה', 
        description: 'קיימים מענים ותוכניות העשרה והעצמה (קבוצתיות ופרטניות), בהתאם למיפוי הצרכים'
      },
      { 
        id: 2, 
        title: 'מענים לרצף היום והשנה', 
        description: 'בית הספר מפעיל טיולים בהתאמה לתוכנית הלימודים ולשכבת הגיל'
      },
      { 
        id: 3, 
        title: 'מענים לרצף היום והשנה', 
        description: 'בית ספר מפעיל מסגרות חינוכיות מגוונות לתלמידים במהלך החופשות'
      },
      { 
        id: 4, 
        title: 'פעילות פנאי אחרי הצוהריים', 
        description: 'בית הספר מקדם שיתופי פעולה עם ארגוני חינוך בלתי פורמלי: תנועות נוער, מתנ"ס ועוד'
      },
      { 
        id: 5, 
        title: 'פעילות פנאי אחרי הצוהריים', 
        description: 'בית הספר מעודד את תלמידיו להשתתף במסגרות של חינוך בלתי פורמלי'
      },
      { 
        id: 6, 
        title: 'פעילות פנאי אחרי הצוהריים', 
        description: 'בית הספר מפעיל חוגים ופעילויות פנאי אחרי שעות הלימודים'
      },
      { 
        id: 7, 
        title: 'חינוך חברתי', 
        description: 'פעילות חינוך חברתי ערכי נעשית בהתאמה לצורכי ולמאפייני הגיל'
      },
      { 
        id: 8, 
        title: 'חינוך חברתי', 
        description: 'למורים יש הידע והמיומנויות הנדרשים לתכנון ולהעברה של שיעורי חינוך וחברה'
      },
      { 
        id: 9, 
        title: 'חינוך חברתי', 
        description: 'נעשה שימוש מיטבי בתומכי הוראה בתחום החברתי: מורות חיילות, מתנדבי שירות לאומי ועוד'
      }
    ]
  },
  {
    id: 'parents',
    title: 'הורים וקהילה',
    items: [
      { 
        id: 1, 
        title: 'ניהול השותפות עם ההורים', 
        description: 'קיימות שגרות סדורות לניהול הקשר עם ההורים, לשיתוף ולהעברת מידע'
      },
      { 
        id: 2, 
        title: 'ניהול השותפות עם ההורים', 
        description: 'ההורים שותפים ומעורבים בפעילות בית הספר ובהובלת תהליכים בית ספריים'
      },
      { 
        id: 3, 
        title: 'ניהול השותפות עם ההורים', 
        description: 'קיימים מענים ותוכניות ללמידה, להעצמה ולייעוץ להורים'
      },
      { 
        id: 4, 
        title: 'ניהול השותפות עם ההורים', 
        description: 'המורים מקבלים ליווי והדרכה לעבודה עם ההורים, ולבניית קשרים של כבוד ואמון'
      },
      { 
        id: 5, 
        title: 'בית הספר כמרכז קהילתי', 
        description: 'מתקיימות פעילויות לחיזוק הקשר בין בית הספר לקהילה'
      },
      { 
        id: 6, 
        title: 'בית הספר כמרכז קהילתי', 
        description: 'בית הספר נותן מענה לצורכי הקהילה ומקיים פעילויות קהילתיות שונות'
      },
      { 
        id: 7, 
        title: 'בית הספר כמרכז קהילתי', 
        description: 'המאפיינים התרבותיים והחברתיים של הקהילה באים לידי ביטוי במסגרת תוכני הלימוד'
      },
      { 
        id: 8, 
        title: 'חיבור למענים הקיימים בקהילה', 
        description: 'קיימות שגרות עבודה עם גורמים רלוונטיים בקהילה וברשות המקומית'
      },
      { 
        id: 9, 
        title: 'חיבור למענים הקיימים בקהילה', 
        description: 'בית הספר מקדם יוזמות חינוכיות עם גורמים בקהילה'
      },
      { 
        id: 10, 
        title: 'חיבור למענים הקיימים בקהילה', 
        description: 'בית הספר מכיר את מגוון המענים המקצועיים הקיימים בקהילה ונעזר בהם'
      },
      { 
        id: 11, 
        title: 'התנדבות בקהילה', 
        description: 'התלמידים פעילים בקהילה במסגרת פרויקטים של התנדבות ומעורבות חברתית'
      },
      { 
        id: 12, 
        title: 'התנדבות בקהילה', 
        description: 'נעשה לאיתור ולגיוס כוחות בתוך בית הספר לשם מתן מענים לצרכים קהילתיים'
      },
      { 
        id: 13, 
        title: 'התנדבות בקהילה', 
        description: 'בית הספר משמש כתובת ליוזמות ולצרכים של הקהילה'
      }
    ]
  },
  {
    id: 'environment',
    title: 'סביבות למידה',
    items: [
      { 
        id: 1, 
        title: 'סביבה בטוחה, בטיחותית, מונגשת ואסתטית', 
        description: 'מבני בית הספר מתוחזקים באופן קבוע, מספקים סביבה בטוחה ומונגשת'
      },
      { 
        id: 2, 
        title: 'סביבה בטוחה, בטיחותית, מונגשת ואסתטית', 
        description: 'התלמידים, ההורים והקהילה שותפים לטיפוח הסביבה הבית ספרית'
      },
      { 
        id: 3, 
        title: 'סביבה בטוחה, בטיחותית, מונגשת ואסתטית', 
        description: 'התשתיות הפיזיות וסביבות הלמידה מותאמות לגיל ולשלב החינוכי'
      },
      { 
        id: 4, 
        title: 'מרחבי למידה למורים ולתלמידים', 
        description: 'קיימים מרחבי למידה פיזיים מגוונים המאפשרים גמישות בדרכי ההוראה-למידה'
      },
      { 
        id: 5, 
        title: 'מרחבי למידה למורים ולתלמידים', 
        description: 'קיימים מרחבי למידה המעוררים שיח בנושאים רגשיים, חברתיים ואקטואליים'
      },
      { 
        id: 6, 
        title: 'מרחבי למידה למורים ולתלמידים', 
        description: 'קיימות סביבות עבודה המותאמות ללמידה פרטנית ולשיח אישי עם התלמידים'
      },
      { 
        id: 7, 
        title: 'מרחבי למידה למורים ולתלמידים', 
        description: 'חדר המורים וסביבות העבודה מאפשרות לצוות לבצע את עבודתו באופן מיטבי'
      },
      { 
        id: 8, 
        title: 'תשתיות טכנולוגיות', 
        description: 'קיימת תשתית המאפשרת שימוש פדגוגי באמצעים טכנולוגיים'
      },
      { 
        id: 9, 
        title: 'תשתיות טכנולוגיות', 
        description: 'קיימים אמצעי קצה (מחשבים, טאבלטים) לשימוש המורים והתלמידים'
      },
      { 
        id: 10, 
        title: 'תשתיות טכנולוגיות', 
        description: 'המורים זוכים לליווי ולהדרכה בנוגע לשימוש בכלים טכנולוגיים'
      },
      { 
        id: 11, 
        title: 'שימוש במשאבי הסביבה החוץ-בית ספרית', 
        description: 'נעשה שימוש משמעותי בחצר בית הספר ובסביבתו ללמידה'
      },
      { 
        id: 12, 
        title: 'שימוש במשאבי הסביבה החוץ-בית ספרית', 
        description: 'המורים משתמשים במרחבים מגוונים ללמידה חוץ-בית ספרית'
      },
      { 
        id: 13, 
        title: 'שימוש במשאבי הסביבה החוץ-בית ספרית', 
        description: 'בית הספר יוזם שיתופי פעולה עם ארגונים ומוסדות לקידום פעילויות פדגוגיות'
      }
    ]
  },
];

export function ZoneMapping() {
  const [scores, setScores] = useState<Record<string, string>>({});
  const [averages, setAverages] = useState<Record<string, number>>({});

  const calculateZoneAverage = useCallback((zoneId: string, items: ZoneItem[]) => {
    const zoneScores = items.map(item => 
      Number(scores[`${zoneId}-${item.id}`]) || 0
    ).filter(score => score > 0);

    if (zoneScores.length === 0) return 0;
    
    const average = zoneScores.reduce((a, b) => a + b, 0) / zoneScores.length;
    return Number(average.toFixed(2));
  }, [scores]);

  useEffect(() => {
    const newAverages = zones.reduce((acc, zone) => ({
      ...acc,
      [zone.id]: calculateZoneAverage(zone.id, zone.items)
    }), {});
    
    setAverages(newAverages);
  }, [scores, calculateZoneAverage]);

  const handleScoreChange = (zoneId: string, itemId: number, value: string) => {
    setScores(prev => ({
      ...prev,
      [`${zoneId}-${itemId}`]: value
    }));
  };

  return (
    <div className="container mx-auto p-4" dir="rtl">
      <Card>
        <CardHeader>
          <h1 className="text-2xl font-bold">מיפוי זירות ואתגרים</h1>
        </CardHeader>
        <CardContent>
          <Accordion type="single" collapsible>
            {zones.map((zone) => (
              <AccordionItem key={zone.id} value={zone.id}>
                <AccordionTrigger>
                  <div className="flex justify-between w-full ml-4">
                    <span>{zone.title}</span>
                    <span className={`text-sm ${
                      averages[zone.id] > 2.5 ? 'text-green-600' : 
                      averages[zone.id] > 1.8 ? 'text-yellow-600' : 
                      averages[zone.id] > 0 ? 'text-red-600' : 'text-gray-400'
                    }`}>
                      {averages[zone.id] > 0 ? `ממוצע: ${averages[zone.id]}` : 'טרם דורג'}
                    </span>
                  </div>
                </AccordionTrigger>
                <AccordionContent>
                {zone.items.map((item) => (
                <div key={item.id} className="p-2 border rounded-lg mb-1">
                <div className="flex justify-between items-center">
                <div className="flex-grow pr-2">
                <h3 className="font-semibold text-sm">{item.title}</h3>
               <p className="text-xs text-gray-600">{item.description}</p>
                </div>
              <div className="flex items-center space-x-2">
                {[3, 2, 1].map((value) => (
               <label key={value} className="flex items-center space-x-1">
                   <input
              type="radio"
              name={`${zone.id}-${item.id}`}
              value={value}
              checked={scores[`${zone.id}-${item.id}`] === value.toString()}
              onChange={(e) => handleScoreChange(zone.id, item.id, e.target.value)}
              className="w-2 h-2"
            />
            <span className="text-sm">{value}</span>
          </label>
        ))}
      </div>
    </div>
  </div>
))}
                </AccordionContent>
              </AccordionItem>
            ))}
          </Accordion>
        </CardContent>
      </Card>
    </div>
  );
}

export default ZoneMapping;